<!DOCTYPE html>
<html>
<head>
  <title>InsightForge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: white;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #22c55e;
    }
    button {
      padding: 15px 25px;
      margin: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }
    .run { background: #22c55e; color: black; }
    .upload { background: #3b82f6; color: white; }
    .report { background: #f59e0b; color: black; }

    #output {
      background: #020617;
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      min-height: 120px;
      text-align: left;
      font-size: 14px;
      overflow: auto;
      .dashboard {
  background: rgba(255,255,255,0.05);
  border-radius: 12px;
  padding: 15px;
  margin-top: 15px;
  text-align: left;
  font-size: 14px;
}

.stat {
  margin: 6px 0;
             }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<h1>ðŸš€ InsightForge Web App</h1>
<p>Upload your CSV and run instant analysis.</p>

<input type="file" id="fileInput" accept=".csv"><br><br>
  
<select id="columnSelect">
  <option value="">Select column...</option>
</select>
<br><br>
<button class="run" onclick="runApp()">Run InsightForge</button>
<button class="report" onclick="downloadReport()">Download Report</button>

<div id="output">Waiting for data...</div>


  
  

  <canvas id="chart" style="max-width:100%; margin-top:20px;"></canvas>
  <div class="dashboard" id="dashboard">
  <h3>ðŸ“Š Live Insights</h3>
  <div class="stat" id="statAvg"></div>
  <div class="stat" id="statMin"></div>
  <div class="stat" id="statMax"></div>
  <div class="stat" id="statGrowth"></div>
  <div class="stat" id="statTrend"></div>
  <div class="stat" id="statAnomaly"></div>
  </div>
  

<script>
let chartInstance = null;

function runApp() {
  const file = document.getElementById("fileInput").files[0];
  const selectedColumn = document.getElementById("columnSelect").value;

  if (!file) {
    alert("Please upload a CSV file first.");
    return;
  }

  const reader = new FileReader();

  reader.onload = function (e) {
    const text = e.target.result.trim();
    const rows = text.split("\n").map(r => r.split(","));

    const headers = rows[0];
    // Populate dropdown with CSV headers
const dropdown = document.getElementById("columnSelect");
dropdown.innerHTML = '<option value="">Select column...</option>';

headers.forEach(h => {
  const option = document.createElement("option");
  option.value = h.trim();
  option.textContent = h.trim();
  dropdown.appendChild(option);
});
    const colIndex = headers.map(h => h.trim()).indexOf(selectedColumn.trim());

    if (colIndex === -1) {
      alert("Column not found in CSV.");
      return;
    }

    let labels = [];
    let values = [];

    for (let i = 1; i < rows.length; i++) {
      labels.push("Row " + i);

      let raw = rows[i][colIndex] || "0";
      raw = raw.replace(/[^0-9.-]/g, "");
      const num = parseFloat(raw);

      values.push(isNaN(num) ? 0 : num);
    }

    // ===== Advanced Analytics Engine =====

// Basic stats
const sum = values.reduce((a,b)=>a+b,0);
const avg = sum / values.length;
const min = Math.min(...values);
const max = Math.max(...values);

// Growth %
const first = values[0];
const last = values[values.length - 1];
const growthPct = ((last - first) / first) * 100;

// Moving average forecast
const windowSize = Math.min(3, values.length);
const recent = values.slice(-windowSize);
const movingAvg = recent.reduce((a,b)=>a+b,0) / windowSize;
const forecast = Math.round(movingAvg);

// Add forecast to chart
labels.push("Forecast");
values.push(forecast);

// Trend strength
const trendDelta = last - values[values.length - 2];
const trendStrength = Math.abs(trendDelta) / avg * 100;

// Anomaly detection
let anomalies = [];
values.slice(0,-1).forEach((v,i)=>{
  if(v > avg * 1.4) anomalies.push(`Row ${i+1} spike`);
  if(v < avg * 0.6) anomalies.push(`Row ${i+1} drop`);
});

// Store report data globally
window._reportData = {
  column: selectedColumn,
  rows: values.length - 1,
  lastValue: last,
  forecast: forecast,
  trend: trendDelta,
  avg: Math.round(avg),
  min,
  max,
  growthPct: growthPct.toFixed(1),
  trendStrength: trendStrength.toFixed(1),
  anomalies
};
    // Update dashboard UI
const dash = document.getElementById("dashboard");
dash.style.display = "block";
dash.style.marginTop = "20px";
dash.scrollIntoView({ behavior: "smooth" });
document.getElementById("statAvg").innerHTML = "ðŸ“Š Average: " + window._reportData.avg;
document.getElementById("statMin").innerHTML = "â¬‡ï¸ Min: " + window._reportData.min;
document.getElementById("statMax").innerHTML = "â¬†ï¸ Max: " + window._reportData.max;
document.getElementById("statGrowth").innerHTML = "ðŸ“ˆ Growth: " + window._reportData.growthPct + "%";
document.getElementById("statTrend").innerHTML = "âš¡ Trend Strength: " + window._reportData.trendStrength + "%";
document.getElementById("statAnomaly").innerHTML = 
  "ðŸš¨ Anomalies: " + (window._reportData.anomalies.length ? window._reportData.anomalies.join(", ") : "None");

    document.getElementById("output").innerHTML =
      "âœ… File loaded successfully<br>" +
      "ðŸ“Š Rows detected: " + values.length + "<br>" +
      "ðŸ”® Forecast generated";

    const ctx = document.getElementById("chart").getContext("2d");

    if (window.chartInstance) {
      window.chartInstance.destroy();
    }

    window.chartInstance = new Chart(ctx, {
      type: "line",
      data: {
        labels: labels,
        datasets: [{
          label: selectedColumn,
          data: values,
          tension: 0.3,
          fill: false
        }]
      },
      options: {
        responsive: true
      }
    });
  };

  reader.readAsText(file);
  }
function downloadReport() {
  if (!window._reportData) {
    alert("Run analysis first before downloading report.");
    return;
  }

  const r = window._reportData;

  const direction =
    r.trend > 0 ? "Upward ðŸ“ˆ" :
    r.trend < 0 ? "Downward ðŸ“‰" :
    "Stable âž–";

  const report = `
INSIGHTFORGE ANALYSIS REPORT
===========================

Selected Column : ${r.column}
Total Rows      : ${r.rows}
Last Value       : ${r.lastValue}
Forecast Value   : ${r.forecast}
Trend Direction  : ${direction}
Trend Delta       : ${r.trend}

Average Value     : ${r.avg}
Minimum Value     : ${r.min}
Maximum Value     : ${r.max}
Growth Percentage : ${r.growthPct}%
Trend Strength    : ${r.trendStrength}%
Anomalies         : ${r.anomalies.length ? r.anomalies.join(", ") : "None"}

Interpretation:
The selected data shows a ${direction.toLowerCase()} trend.
Growth rate indicates how much the value has changed from the first to the latest entry.
Trend strength measures how strong recent movement is compared to the overall average.

Generated by InsightForge Web App
`;

  const blob = new Blob([report], { type: "text/plain" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "insightforge_report.txt";
  link.click();
  }

</script>

</body>
</html>
