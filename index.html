<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Paragon Analytics</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
:root {
  --bg:#1b102f; --card:#24133d; --accent:#8b5cf6; --gold:#facc15; --text:#f5f3ff;
}
body{margin:0;padding:16px;background:var(--bg);color:var(--text);font-family:system-ui}
h1,h2,h3{color:var(--gold)}
.card{background:var(--card);border-radius:14px;padding:16px;margin-bottom:18px}
.metrics{display:flex;gap:12px;flex-wrap:wrap}
.metric{flex:1;background:#2e1a55;border-radius:12px;padding:12px;text-align:center}
input,select,button{width:100%;padding:10px;border-radius:10px;border:none;margin-top:8px}
button{background:linear-gradient(135deg,var(--accent),var(--gold));color:#1b102f;font-weight:bold}
canvas{background:#1b102f;border-radius:12px;padding:8px}
.warn{color:#fca5a5}
.good{color:#86efac}
</style>
</head>

<body>

<h1>üîÆ Paragon Analytics</h1>

<div class="card">
  <h2>üìÅ Upload CSV</h2>
  <input type="file" accept=".csv" id="csvInput">
  <select id="valueColumn"></select>
  <div id="validation"></div>
</div>

<div class="metrics" id="metrics"></div>

<div class="card"><canvas id="trendChart"></canvas></div>
<div class="card"><canvas id="barChart"></canvas></div>
<div class="card"><canvas id="pieChart"></canvas></div>

<div class="card" id="analysis"></div>

<button onclick="exportPDF()">üìÑ Export Full PDF Report</button>

<script>
let raw=[], values=[], charts=[];

const mean=a=>a.reduce((x,y)=>x+y,0)/a.length;
const std=a=>{const m=mean(a);return Math.sqrt(mean(a.map(v=>(v-m)**2)))};

csvInput.onchange=e=>{
 Papa.parse(e.target.files[0],{
  header:true,skipEmptyLines:true,
  complete:r=>{
   raw=r.data;
   const cols=Object.keys(raw[0]).filter(c=>!isNaN(raw[0][c]));
   valueColumn.innerHTML=cols.map(c=>`<option>${c}</option>`).join("");
   analyze();
  }
 });
};
valueColumn.onchange=analyze;

function analyze(){
 values=raw.map(r=>+r[valueColumn.value]).filter(v=>!isNaN(v));
 validateData();
 compute();
}

function validateData(){
 let msgs=[];
 if(values.length<8) msgs.push("Dataset is short; forecast confidence reduced.");
 if(std(values)==0) msgs.push("No variability detected.");
 validation.innerHTML=msgs.length
  ? `<p class="warn">‚ö† ${msgs.join(" ")}</p>`
  : `<p class="good">‚úì Data passed validation</p>`;
}

function compute(){
 const avg=mean(values);
 const vol=std(values);
 const normVol=vol/avg;
 const slope=(values.at(-1)-values[0])/values.length;

 // backtest
 let errors=[];
 for(let i=5;i<values.length;i++){
  const past=values.slice(0,i);
  const pred=past.at(-1)+(past.at(-1)-past[0])/past.length;
  errors.push(Math.abs((values[i]-pred)/values[i]));
 }
 const mape=mean(errors)*100;

 const confidence=Math.max(0,100-(mape*1.5)-(normVol*100));

 metrics.innerHTML=`
  <div class="metric"><h3>Average</h3><p>${avg.toFixed(2)}</p></div>
  <div class="metric"><h3>Volatility</h3><p>${(normVol*100).toFixed(1)}%</p></div>
  <div class="metric"><h3>Confidence</h3><p>${confidence.toFixed(0)}%</p></div>
 `;

 const forecast=Math.round(values.at(-1)+slope*values.length);

 analysis.innerHTML=`
  <h2>üß† Analysis & Forecast</h2>
  <p>The data shows a ${slope>0?"positive":"negative"} long-term trend with
  ${normVol>0.3?"high":"moderate"} volatility.</p>
  <p>The forecast for the next period is <b>${forecast}</b>.</p>
  <p>Forecast confidence is estimated at <b>${confidence.toFixed(0)}%</b>
  based on historical stability and backtest accuracy.</p>
  <h3>Recommendations</h3>
  <ul>
    <li>${normVol>0.3?"Stabilize operations to reduce volatility.":"Maintain current strategy."}</li>
    <li>${confidence<60?"Use forecast cautiously.":"Forecast is reasonably reliable."}</li>
  </ul>
 `;

 renderCharts(forecast);
}

function renderCharts(forecast){
 charts.forEach(c=>c.destroy()); charts=[];
 charts.push(new Chart(trendChart,{type:"line",
  data:{labels:values.map((_,i)=>i+1),
  datasets:[{label:"Trend",data:values,borderColor:"#8b5cf6"}]}}));
 charts.push(new Chart(barChart,{type:"bar",
  data:{labels:values.map((_,i)=>i+1),
  datasets:[{label:"Values",data:values,backgroundColor:"#facc15"}]}}));
 charts.push(new Chart(pieChart,{type:"pie",
  data:{labels:["Last","Forecast"],
  datasets:[{data:[values.at(-1),forecast],
  backgroundColor:["#8b5cf6","#facc15"]}]}));
}

function exportPDF(){
 const {jsPDF}=window.jspdf;
 const pdf=new jsPDF();
 pdf.text("Paragon Analytics Report",14,20);
 pdf.text(analysis.innerText,14,35,{maxWidth:180});
 pdf.addPage();
 charts.forEach((c,i)=>{
  pdf.addImage(c.canvas.toDataURL(), "PNG", 15, 20, 180, 90);
  if(i<charts.length-1) pdf.addPage();
 });
 pdf.save("paragon_analytics_report.pdf");
}
</script>

</body>
</html>
