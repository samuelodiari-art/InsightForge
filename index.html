<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PARAGON ANALYTICS v3.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  background: radial-gradient(circle at top,#14002a,#050012);
  color:white;
  font-family:Arial, sans-serif;
  text-align:center;
}
button,select{
  padding:10px;margin:5px;border-radius:6px;border:none;font-weight:bold;
}
.primary{background:gold;color:black;}
.secondary{background:#333;color:white;}
.panel{max-width:1200px;margin:auto;padding:10px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px;}
.card{background:rgba(255,255,255,0.08);padding:12px;border-radius:10px;}
.value{font-size:18px;font-weight:bold;}
canvas{background:rgba(255,255,255,0.05);border-radius:10px;margin-top:18px;}
textarea{width:96%;height:280px;border-radius:8px;padding:10px;}
</style>
</head>

<body>

<h2>PARAGON ANALYTICS â€” v3.0</h2>
<p>Virtual Business Consultant (Phase 1)</p>

<input type="file" id="csvFile"><br>

<select id="metricSelect">
  <option value="Revenue">Revenue</option>
  <option value="Cost">Cost</option>
  <option value="Units_Sold">Units Sold</option>
</select>

<br>
<button class="primary" onclick="loadCSV()">Load CSV</button>
<button class="secondary" onclick="runAnalytics()">Run Analysis</button>

<div class="panel">

<canvas id="trendChart"></canvas>

<h3>Key Metrics</h3>
<div class="grid" id="kpiPanel"></div>

<h3>Consultant Assessment</h3>
<textarea id="insightText"></textarea>

</div>

<script>
let headers=[], rows=[], chart;

/* ---------------- CSV ---------------- */

function loadCSV(){
  const f=csvFile.files[0];
  if(!f) return alert("Upload CSV");
  const r=new FileReader();
  r.onload=e=>{
    const l=e.target.result.trim().split("\n");
    headers=l[0].split(",").map(x=>x.trim());
    rows=l.slice(1).map(x=>x.split(","));
    alert("CSV loaded");
  };
  r.readAsText(f);
}

/* ---------------- CORE ---------------- */

function runAnalytics(){
  if(!rows.length) return alert("Load CSV first");

  const metric=metricSelect.value;
  const dI=headers.indexOf("Date");
  const mI=headers.indexOf(metric);

  if(dI===-1||mI===-1) return alert("CSV needs Date + metric");

  const data=rows.map(r=>({
    date:new Date(r[dI]),
    value:parseFloat(r[mI])
  })).filter(x=>isFinite(x.value)&&!isNaN(x.date));

  const values=data.map(d=>d.value);

  const stats=analyzeSignals(values);
  const forecast=consultantForecast(values,stats);
  const verdict=businessVerdict(stats);
  const confidence=confidenceLogic(stats);
  const recommendation=recommendationLogic(verdict,confidence);

  renderChart(values,forecast.base);
  renderKPIs(stats);
  renderNarrative(verdict,confidence,forecast,recommendation,stats);
}

/* ---------------- ANALYSIS ---------------- */

function analyzeSignals(v){
  const m=mean(v);
  const s=std(v);
  const vol=(s/(Math.abs(m)||1))*100;
  const growth=((v[v.length-1]-v[0])/(Math.abs(v[0])||1))*100;

  const anomalies=v.filter(x=>Math.abs(x-m)>2*s).length;

  return{
    mean:m,
    volatility:vol,
    growth:growth,
    anomalies:anomalies,
    stability: vol<30 && anomalies<2
  };
}

/* ---------------- FORECAST (CONSERVATIVE) ---------------- */

function consultantForecast(v,stats){
  const last=v[v.length-1];
  const trend=(last-v[Math.max(0,v.length-6)])/(Math.min(6,v.length-1)||1);

  let base=[1,2,3].map(i=>round(last+trend*i));

  let usability="Suitable for planning";
  if(stats.volatility>40||stats.anomalies>3) usability="Use with caution";
  if(v.length<8) usability="Indicative only";

  return{base,usability};
}

/* ---------------- VERDICT ---------------- */

function businessVerdict(s){
  if(s.stability && s.growth>0) return "Strong & Stable";
  if(!s.stability && s.growth>0) return "Growth with Elevated Risk";
  if(s.stability && s.growth<=0) return "Stable with Watchpoints";
  return "Operationally Fragile";
}

/* ---------------- CONFIDENCE ---------------- */

function confidenceLogic(s){
  let c=80;
  if(s.volatility>40) c-=20;
  if(s.anomalies>2) c-=15;
  if(Math.abs(s.growth)>50) c-=10;
  return Math.max(30,Math.min(90,c));
}

/* ---------------- RECOMMENDATION ---------------- */

function recommendationLogic(v,c){
  if(v==="Strong & Stable")
    return "Maintain current strategy and consider modest expansion.";
  if(v==="Growth with Elevated Risk")
    return "Proceed cautiously; prioritize stabilizing volatility before scaling.";
  if(v==="Stable with Watchpoints")
    return "Hold course while monitoring early warning indicators.";
  return "Focus on stabilization before pursuing growth.";
}

/* ---------------- RENDER ---------------- */

function renderChart(actual,forecast){
  if(chart) chart.destroy();
  chart=new Chart(trendChart,{
    type:"line",
    data:{
      labels:[...actual.map((_,i)=>i+1),"F1","F2","F3"],
      datasets:[
        {label:"Actual",data:actual},
        {label:"Forecast",data:[...Array(actual.length).fill(null),...forecast],borderDash:[5,5]}
      ]
    }
  });
}

function renderKPIs(s){
  kpiPanel.innerHTML=`
    <div class="card">Growth<div class="value">${round(s.growth)}%</div></div>
    <div class="card">Volatility<div class="value">${round(s.volatility)}%</div></div>
    <div class="card">Anomalies<div class="value">${s.anomalies}</div></div>
  `;
}

function renderNarrative(v,c,f,r,s){
  insightText.value=
`EXECUTIVE VERDICT
${v}

ASSESSMENT
The business shows ${s.stability?"stable":"unstable"} operating patterns with ${round(s.growth)}% growth and ${round(s.volatility)}% volatility.

FORECAST OUTLOOK
Short-term projections are ${f.usability.toLowerCase()}.

RECOMMENDATION
${r}

CAVEATS
This assessment assumes current demand patterns persist and volatility does not materially increase.

CONFIDENCE
Overall confidence is ${c}%, reflecting ${s.stability?"signal agreement":"signal contradictions"} in the data.
`;
}

/* ---------------- MATH ---------------- */

function mean(a){return a.reduce((x,y)=>x+y,0)/a.length;}
function std(a){let m=mean(a);return Math.sqrt(mean(a.map(x=>(x-m)**2)));}
function round(x){return Math.round(x*100)/100;}

</script>
</body>
  </html>
