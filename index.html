<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Paragon Analytics</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
:root {
  --bg: #1b102f;
  --card: #24133d;
  --accent: #8b5cf6;
  --gold: #facc15;
  --text: #f5f3ff;
}

body {
  margin: 0;
  padding: 16px;
  background: var(--bg);
  color: var(--text);
  font-family: system-ui, sans-serif;
}

h1, h2 {
  color: var(--gold);
}

.card {
  background: var(--card);
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 18px;
}

.metrics {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.metric {
  flex: 1;
  background: #2e1a55;
  border-radius: 12px;
  padding: 12px;
  text-align: center;
}

input, select, button {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: none;
  margin-top: 8px;
}

button {
  background: linear-gradient(135deg, var(--accent), var(--gold));
  color: #1b102f;
  font-weight: bold;
}

canvas {
  background: #1b102f;
  border-radius: 12px;
  padding: 8px;
}
</style>
</head>

<body>

<h1>üîÆ Paragon Analytics</h1>

<div class="card">
  <h2>üìÅ Upload CSV</h2>
  <input type="file" accept=".csv" id="csvInput" />
  <select id="valueColumn"></select>
</div>

<div class="metrics" id="metrics"></div>

<div class="card"><canvas id="lineChart"></canvas></div>
<div class="card"><canvas id="barChart"></canvas></div>
<div class="card"><canvas id="pieChart"></canvas></div>

<div class="card" id="insights"></div>

<button onclick="exportPDF()">üìÑ Export PDF Report</button>

<script>
let rawData = [];
let numericData = [];
let chartRefs = [];

function mean(arr){return arr.reduce((a,b)=>a+b,0)/arr.length;}
function std(arr){const m=mean(arr);return Math.sqrt(mean(arr.map(v=>(v-m)**2)));}

document.getElementById("csvInput").addEventListener("change", e => {
  Papa.parse(e.target.files[0], {
    header: true,
    skipEmptyLines: true,
    complete: res => {
      rawData = res.data;
      const cols = Object.keys(rawData[0]).filter(c => !isNaN(rawData[0][c]));
      const sel = document.getElementById("valueColumn");
      sel.innerHTML = cols.map(c=>`<option>${c}</option>`).join("");
      analyze();
    }
  });
});

document.getElementById("valueColumn").addEventListener("change", analyze);

function analyze(){
  const col = valueColumn.value;
  numericData = rawData.map(r => Number(r[col])).filter(v=>!isNaN(v));

  const avg = mean(numericData);
  const volatility = std(numericData);
  const growth = ((numericData.at(-1)-numericData[0])/numericData[0])*100;

  document.getElementById("metrics").innerHTML = `
    <div class="metric"><h3>Average</h3><p>${avg.toFixed(2)}</p></div>
    <div class="metric"><h3>Volatility</h3><p>${volatility.toFixed(2)}</p></div>
    <div class="metric"><h3>Total Growth</h3><p>${growth.toFixed(2)}%</p></div>
  `;

  const trend = numericData.map((v,i)=>v - i*(numericData.at(-1)-numericData[0])/numericData.length);
  const forecast = Math.round((mean(trend)+numericData.at(-1))/2);

  document.getElementById("insights").innerHTML = `
    <h2>üß† Analysis</h2>
    <p>The selected metric shows a ${growth>0?"positive":"negative"} long-term trend with
    ${volatility>avg*0.25?"high":"moderate"} volatility. Momentum suggests the next period
    is likely around <b>${forecast}</b>, assuming current conditions persist.</p>
  `;

  renderCharts(numericData, forecast);
}

function renderCharts(data, forecast){
  chartRefs.forEach(c=>c.destroy());
  chartRefs=[];

  chartRefs.push(new Chart(lineChart,{type:"line",
    data:{labels:data.map((_,i)=>i+1),datasets:[{label:"Trend",data}]}}));

  chartRefs.push(new Chart(barChart,{type:"bar",
    data:{labels:data.map((_,i)=>i+1),datasets:[{label:"Values",data}]}}));

  chartRefs.push(new Chart(pieChart,{type:"pie",
    data:{labels:["Last","Forecast"],datasets:[{data:[data.at(-1),forecast]}]}}));
}

function exportPDF(){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  pdf.text("Paragon Analytics Report", 14, 20);
  pdf.text(document.getElementById("insights").innerText, 14, 35);
  pdf.save("paragon_report.pdf");
}
</script>

</body>
</html>
