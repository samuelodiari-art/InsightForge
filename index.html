<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PARAGON ANALYTICS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Chart + PDF libs -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
  font-family: system-ui, Arial;
  background: linear-gradient(135deg, #2a003f, #5a2d82, #c9a227);
  color: white;
  text-align: center;
  padding: 14px;
}

h1 {
  letter-spacing: 2px;
  color: #ffd700;
}

.tagline {
  opacity: 0.9;
  margin-bottom: 15px;
}

button {
  padding: 14px 22px;
  border-radius: 10px;
  border: none;
  font-weight: bold;
  cursor: pointer;
  margin: 6px;
}

.load { background: #5e2ea5; color: white; }
.run { background: gold; color: black; }
.pdf { background: #3b1c64; color: white; }

select, input {
  padding: 10px;
  border-radius: 8px;
  border: none;
  margin: 6px;
}

.panel {
  background: rgba(0,0,0,0.35);
  padding: 12px;
  border-radius: 12px;
  margin-top: 12px;
}

canvas { max-width: 100%; margin-top: 15px; }

.stat { margin: 4px 0; }

footer {
  margin-top: 20px;
  opacity: 0.6;
  font-size: 12px;
}
</style>
</head>

<body>

<h1>PARAGON ANALYTICS</h1>
<div class="tagline">Smart Business Intelligence & Forecasting</div>

<input type="file" id="fileInput" accept=".csv">
<br>
<button class="load" onclick="loadCSV()">Load CSV</button>

<br>
<select id="columnSelect"></select>

<br>
<button class="run" onclick="runAnalysis()">Run AI Analysis</button>
<button class="pdf" onclick="downloadPDF()">Download Report PDF</button>

<div id="status" class="panel">Waiting for CSV...</div>

<canvas id="chart"></canvas>

<div id="insights" class="panel" style="display:none;"></div>

<footer>
PARAGON ANALYTICS â€” Automated Forecast Intelligence
</footer>

<script>
let rawCSV = "";
let headers = [];
let rows = [];
let chart = null;
let reportData = null;

// ---------------- LOAD CSV ----------------
function loadCSV(){
  const file = document.getElementById("fileInput").files[0];
  if(!file){ alert("Please select a CSV file."); return; }

  const reader = new FileReader();
  reader.onload = e => {
    rawCSV = e.target.result.trim();
    parseCSV();
  };
  reader.readAsText(file);
}

function parseCSV(){
  rows = rawCSV.split("\n").map(r => r.split(","));
  headers = rows[0].map(h => h.trim());

  const dropdown = document.getElementById("columnSelect");
  dropdown.innerHTML = "";
  headers.forEach(h=>{
    const opt = document.createElement("option");
    opt.value = h;
    opt.textContent = h;
    dropdown.appendChild(opt);
  });

  document.getElementById("status").innerHTML = "CSV Loaded Successfully âœ…";
}

// ---------------- CLEAN NUMBER ----------------
function cleanNumber(v){
  if(!v) return NaN;
  return parseFloat(
    v.replace(/[^0-9.-]/g,"").trim()
  );
}

// ---------------- ANALYSIS ----------------
function runAnalysis(){
  const column = document.getElementById("columnSelect").value;
  const colIndex = headers.indexOf(column);
  if(colIndex === -1){
    alert("Invalid column selected.");
    return;
  }

  let values = [];
  for(let i=1;i<rows.length;i++){
    const num = cleanNumber(rows[i][colIndex]);
    if(!isNaN(num) && isFinite(num)) values.push(num);
  }

  if(values.length < 6){
    alert("Not enough valid numeric data found.");
    return;
  }

  // Stats
  const avg = values.reduce((a,b)=>a+b,0)/values.length;
  const min = Math.min(...values);
  const max = Math.max(...values);
  const growth = ((values.at(-1)-values[0])/values[0])*100;

  // ---------------- SEASONAL MODEL ----------------
  const seasonLength = Math.min(12, Math.floor(values.length/2));
  let seasonalAvg = new Array(seasonLength).fill(0);
  let counts = new Array(seasonLength).fill(0);

  values.forEach((v,i)=>{
    seasonalAvg[i % seasonLength]+=v;
    counts[i % seasonLength]++;
  });
  seasonalAvg = seasonalAvg.map((v,i)=>v/counts[i]);

  // ---------------- TREND REGRESSION ----------------
  const x = values.map((_,i)=>i+1);
  const y = values;
  const n = x.length;
  const sumX = x.reduce((a,b)=>a+b,0);
  const sumY = y.reduce((a,b)=>a+b,0);
  const sumXY = x.reduce((s,xi,i)=>s+xi*y[i],0);
  const sumX2 = x.reduce((s,xi)=>s+xi*xi,0);
  const slope = (n*sumXY - sumX*sumY)/(n*sumX2 - sumX*sumX);
  const intercept = (sumY - slope*sumX)/n;

  // ---------------- FORECAST ----------------
  const futureSteps = 5;
  let forecast = [];
  for(let i=1;i<=futureSteps;i++){
    const trend = slope*(n+i)+intercept;
    const season = seasonalAvg[(n+i-1)%seasonLength] || 0;
    forecast.push(Math.round((trend+season)/2));
  }

  // ---------------- CONFIDENCE ----------------
  const std = Math.sqrt(values.map(v=>(v-avg)**2).reduce((a,b)=>a+b)/values.length);
  const upper = forecast.map(v=>Math.round(v+std));
  const lower = forecast.map(v=>Math.round(v-std));

  // ---------------- SUMMARY ----------------
  const summary = `
The dataset shows an average value of ${avg.toFixed(0)} with a growth rate of ${growth.toFixed(1)}%.
Seasonality was detected with a cycle length of approximately ${seasonLength} periods.
Forecast projects continued movement with moderate confidence bands.
This insight supports data-driven planning, budgeting and performance optimization.
  `.trim();

  reportData = { column, avg, min, max, growth, forecast, upper, lower, seasonLength, summary };

  renderChart(values, forecast, upper, lower, seasonalAvg, seasonLength);
  renderInsights(reportData);

  document.getElementById("status").innerHTML = "AI Analysis Complete âœ…";
}

// ---------------- CHART ----------------
function renderChart(values, forecast, upper, lower, seasonalAvg, seasonLength){
  const labels = values.map((_,i)=>"R"+(i+1))
    .concat(forecast.map((_,i)=>"F"+(i+1)));

  const paddedForecast = new Array(values.length-1).fill(null).concat(forecast);
  const paddedUpper = new Array(values.length-1).fill(null).concat(upper);
  const paddedLower = new Array(values.length-1).fill(null).concat(lower);

  if(chart) chart.destroy();

  chart = new Chart(document.getElementById("chart"),{
    type:"line",
    data:{
      labels,
      datasets:[
        { label:"Actual", data:values, borderWidth:3, tension:0.3, pointRadius:4 },
        { label:"Forecast", data:paddedForecast, borderDash:[5,5], tension:0.3 },
        { label:"Upper Confidence", data:paddedUpper, borderDash:[2,6] },
        { label:"Lower Confidence", data:paddedLower, borderDash:[2,6] }
      ]
    },
    options:{ responsive:true }
  });
}

// ---------------- INSIGHTS ----------------
function renderInsights(r){
  const div = document.getElementById("insights");
  div.style.display="block";
  div.innerHTML = `
  <div class="stat">ðŸ“Š Average: ${r.avg.toFixed(0)}</div>
  <div class="stat">â¬‡ Min: ${r.min}</div>
  <div class="stat">â¬† Max: ${r.max}</div>
  <div class="stat">ðŸ“ˆ Growth: ${r.growth.toFixed(1)}%</div>
  <div class="stat">ðŸ§­ Season Length: ${r.seasonLength}</div>
  <div class="stat">ðŸ”® Forecast: ${r.forecast.join(", ")}</div>
  <hr>
  <b>Summary</b><br>${r.summary}
  `;
}

// ---------------- PDF EXPORT ----------------
async function downloadPDF(){
  if(!reportData){ alert("Run analysis first."); return; }

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  pdf.setFontSize(18);
  pdf.text("PARAGON ANALYTICS", 10, 15);
  pdf.setFontSize(11);
  pdf.text("Smart Business Intelligence & Forecasting",10,22);

  pdf.setFontSize(12);
  pdf.text(`Column: ${reportData.column}`,10,35);
  pdf.text(`Average: ${reportData.avg.toFixed(0)}`,10,42);
  pdf.text(`Min: ${reportData.min}`,10,49);
  pdf.text(`Max: ${reportData.max}`,10,56);
  pdf.text(`Growth: ${reportData.growth.toFixed(1)}%`,10,63);
  pdf.text(`Forecast: ${reportData.forecast.join(", ")}`,10,70);

  pdf.text("Executive Summary:",10,85);
  pdf.setFontSize(10);
  pdf.text(reportData.summary,10,92,{maxWidth:180});

  const canvas = document.getElementById("chart");
  const img = canvas.toDataURL("image/png",1.0);
  pdf.addPage();
  pdf.addImage(img,"PNG",10,20,180,100);

  pdf.save("Paragon_Analytics_Report.pdf");
}
</script>

</body>
</html>
